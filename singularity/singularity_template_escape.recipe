Bootstrap: docker
From: ubuntu:latest

%files
        env_template_escape.yml

%post
        apt-get -y update
        apt-get -y install git
        apt-get -y install wget
        apt-get clean

        wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
        bash Miniconda3-latest-Linux-x86_64.sh -b -p /opt/conda
        rm Miniconda3-latest-Linux-x86_64.sh
        export PATH="/opt/conda/bin:$PATH"
	    export LD_LIBRARY_PATH="/opt/conda/bin:$LD_LIBRARY_PATH"
	    echo ". activate escape_template" >> /etc/bash.bashrc

        /opt/conda/bin/conda env create -f env_template_escape.yml
        . activate escape_template

	    git clone https://gitlab.in2p3.fr/escape2020/escape/template_project_escape.git
        cd template_project_escape
	    git pull origin
#        git fetch --tags
#        tag=$(git describe --tags `git rev-list --tags --max-count=1`)
#        git checkout $tag -b master_tag_$tag
        git checkout singularity_container
        python setup.py install

%runscript
        . /opt/conda/etc/profile.d/conda.sh
        source activate escape_template
        square_number -i $1

%help
        This is a template container used to illustrate a simple singularity recipe.
         - It downloads and install miniconda3, git and wget.
         - It clones and install a git repository.

         To run the image :
         >> singularity run escape_tempalte.simg -7