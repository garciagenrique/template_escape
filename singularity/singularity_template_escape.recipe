Bootstrap: docker
From: continuumio/miniconda3

%files
        env_template_escape.yml

%environment
        # export LC_ALL=C
        PATH=/opt/conda/envs/$(head -1 env_template_escape.yml | cut -d' ' -f2)/bin:$PATH

%post
        # apt-get -y update
        # apt-fet clean

        echo ". /opt/conda/etc/profile.d/conda.sh" >> ~/.bashrc
        echo "source activate $(head -1 env_template_escape.yml | cut -d' ' -f2)" >> ~/.bashrc
        /opt/conda/bin/conda env create -f env_template_escape.yml
        git clone https://gitlab.in2p3.fr/escape2020/escape/template_project_escape.git
        #git clone https://github.com/garciagenrique/template_project_escape.git
        cd template_project_escape
        git fetch --tags
        tag=$(git describe --tags `git rev-list --tags --max-count=1`)
        git checkout $tag -b master_tag_$tag
        export PATH="/opt/conda/bin:$PATH"
        #/opt/conda/bin/conda init bash
        /opt/conda/bin/conda activate escape_template
        python setup.py install
        #source ~/.bashrc; conda activate escape_template; python setup.py install

%runscript
        source activate escape_template
        square_number -i $1

%help
        This is a template container used to illustrate a simple singularity recipe.